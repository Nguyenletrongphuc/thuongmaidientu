<!DOCTYPE html>
<html lang="vn">
<head>
    <title>Sách Ơi - Thể loại</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="asset/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Lobster&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="asset/img/themify-icons-font/themify-icons/themify-icons.css">
    <script src="asset/dongbodangnhap.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="grid">
                <nav class="header__navbar ">
                    <ul class="header__nav-list">
                        <li class="header__nav-item phancach">Vào cửa hàng trên ứng dụng</li>
                        <li class="header__nav-item">Kết nối
                            <a href="https://facebook.com" class="nav-item__icon"><i class="ti-facebook"></i></a>
                            <a href="https://instagram.com" class="nav-item__icon"><i class="ti-instagram"></i></a>
                        </li>
                        <li class="header__nav-item hearder__thongbao__hien">
                            <a href="" class="nav-item__icon"><i class="ti-bell"></i> Thông báo</a>
                            <div class="hearder_thongbao">
                                <header class="hearder_thongbao-head"><h3>Thông Báo Mới</h3></header>
                                <ul class="hearder_thongbao_list">
                                    <li class="hearder_thongbao_list_item">
                                        <a href="" class="hearder_thongbao_link">
                                            <img src="https://ischool.vn/wp-content/uploads/2022/12/nhung-cuon-sach-hay-cho-tre-10-tuoi-3.jpg" alt="">
                                            <div class="hearder_thongbao_info">
                                                <p class="hearder_thongbao_name">Sách trẻ em</p>
                                                <p class="hearder_thongbao_mota">Phù hợp cho tuổi 5-10</p>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                                <footer class="hearder_thongbao-footer">
                                    <a href="" class="hearder_thongbao-footer-btn">Xem tất cả</a>
                                </footer>
                            </div>
                        </li>
                        <li class="header__nav-item">
                            <a href="" class="nav-item__icon"><i class="ti-help-alt"></i> Trợ giúp</a>
                        </li>
                        <li class="header__nav-item">
                            <a href="admin2084.html" id="adminLink" class="go-admin">Admin</a>
                        </li>
                    </ul>
                    <ul class="header__nav-list">
                        <li class="header__nav_user_btn">
                            <button class="signup custom-btn btn-9">
                                <a href="signup.html">Đăng Nhập/Đăng Ký</a>
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="grid__timkiem">
                <div class="header__logo">
                    <a href="index.html" class="header__logo-link">
                        <img src="asset/img/logosachoi.png" alt="" class="header__logo-img">
                    </a>
                </div>
                <form id="searchForm" class="header__search">
                    <input type="text" id="searchInput" class="header__search-input" placeholder="Tìm kiếm sản phẩm">
                    <button type="submit" class="header__search-btn"><i class="ti-search"></i></button>
                </form>
                <div class="header__cart">
                    <a href="giohang.html" class="header__cart-link"><i class="ti-shopping-cart"></i></a>
                    <div class="header__cart_list header__cart_list__none ">
                        <img src="https://lucaga.com/assets/images/no-cart.png" alt="no__cart" class="no__cart__img">
                    </div>
                </div>
            </div>
        </header>
        <div class="content">
            <div class="grid">
                <div class="grid_row">
                    <div class="grid_colum_2">
                        <nav class="catelory">
                            <ul class="catelory_list">
                                <h3 class="catelory_heading">
                                    <i class="ti-menu-alt"></i>
                                    Danh Mục
                                </h3>
                                <li class="catelory_item"><a href="theloai.html?category=Truyện tranh" class="catelory_link">Truyện tranh</a></li>
                                <li class="catelory_item"><a href="theloai.html?category=Tiểu thuyết" class="catelory_link">Tiểu thuyết</a></li>
                                <li class="catelory_item"><a href="theloai.html?category=Văn học" class="catelory_link">Văn học</a></li>
                            </ul>
                        </nav>
                    </div>
                    <div class="grid_colum_10">
                        <div class="home_product">
                            <h2 id="title" class="theloai-page-title"></h2>
                            <div class="grid_row_2" id="product-list"></div>
                        </div>
                        <ul class="pagination pagination_margin"></ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            <div class="footer-container">
                <div class="footer-col">
                    <h3 class="footer-title">Sách Ơi - Kết nối tri thức</h3>
                    <p class="footer-desc">Nền tảng thương mại điện tử sách hàng đầu, mang đến cho bạn trải nghiệm mua sắm tiện lợi, đa dạng và an toàn.</p>
                    <div class="footer-social">
                        <a href="https://facebook.com" target="_blank" class="footer-social-link"><i class="ti-facebook"></i></a>
                        <a href="https://instagram.com" target="_blank" class="footer-social-link"><i class="ti-instagram"></i></a>
                        <a href="mailto:sachoi@email.com" class="footer-social-link"><i class="ti-email"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h3>Liên hệ</h3>
                    <ul class="footer-contact">
                        <li><i class="ti-location-pin"></i> 123 Đường Sách, Quận 1, TP.HCM</li>
                        <li><i class="ti-mobile"></i> 0334 321 797</li>
                        <li><i class="ti-email"></i> sachoi@email.com</li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Về chúng tôi</h3>
                    <ul class="footer-links">
                        <li><a href="#">Giới thiệu</a></li>
                        <li><a href="#">Điều khoản sử dụng</a></li>
                        <li><a href="#">Chính sách bảo mật</a></li>
                        <li><a href="#">Hỗ trợ khách hàng</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Đăng ký nhận tin</h3>
                    <form class="footer-newsletter" onsubmit="event.preventDefault();alert('Cảm ơn bạn đã đăng ký!');">
                        <input type="email" placeholder="Nhập email của bạn" required>
                        <button type="submit"><i class="ti-arrow-right"></i></button>
                    </form>
                    <p class="footer-copyright">&copy; 2025 Sách Ơi. All rights reserved.</p>
                </div>
            </div>
        </div>
    </div>
    <script>
    // Xử lý tìm kiếm
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("searchForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const query = document.getElementById("searchInput").value.trim();
            if (query) {
                window.location.href = `timkiem.html?query=${encodeURIComponent(query)}`;
            }
        });
    });
    </script>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        const category = params.get("category");
        const titleEl = document.getElementById("title");
        titleEl.textContent = category ? `Thể loại: ${category}` : "Tất cả sản phẩm";

        let currentPage = 1;
        let totalPages = 1;

        async function fetchAndRenderProducts(page = 1) {
            try {
                const res = await fetch(`http://localhost:5000/api/products/get-products?category=${encodeURIComponent(category)}&page=${page}&limit=15`);
                const data = await res.json();
                renderProducts(data.products);
                totalPages = data.totalPages;
                currentPage = data.page;
                renderPagination();
            } catch (err) {
                console.error("Lỗi khi lấy sản phẩm:", err);
            }
        }

        function renderProducts(products) {
            const container = document.getElementById("product-list");
            container.innerHTML = products.map(product => `
                <div class="grid_colum_2_4">
                    <div class="home_product_item" onclick="goToProductDetail('${product._id}')">
                        <div class="home_product_item_img" style="background-image: url('${product.image}');"></div>
                        <h4 class="home_product_item_name">${product.name}</h4>
                        <p class="home_product_item_price">Giá: ${product.price.toLocaleString("vi-VN")} VNĐ</p>
                        <div class="home_product_item_action">
                            <button class="add-to-cart-btn" onclick="event.stopPropagation(); addToCart(${JSON.stringify(product)})">
                                Thêm vào giỏ
                            </button>
                            <span class="like">
                                <i class="saled">${product.sold} Đã bán</i>
                            </span>
                        </div>
                    </div>
                </div>
            `).join("");
        }

        function renderPagination() {
            const pagination = document.querySelector(".pagination");
            if (!pagination) return;
            let html = '';

            // Nút prev
            html += `<li class="pagination_item${currentPage === 1 ? ' pagination_item_disabled' : ''}">
                <a href="#" class="pagination_item_link" data-page="${currentPage - 1}"><i class="ti-angle-left"></i></a>
            </li>`;

            // Số trang
            for (let i = 1; i <= totalPages; i++) {
                html += `<li class="pagination_item${i === currentPage ? ' pagination_item_active' : ''}">
                    <a href="#" class="pagination_item_link" data-page="${i}">${i}</a>
                </li>`;
            }

            // Nút next
            html += `<li class="pagination_item${currentPage === totalPages ? ' pagination_item_disabled' : ''}">
                <a href="#" class="pagination_item_link" data-page="${currentPage + 1}"><i class="ti-angle-right"></i></a>
            </li>`;

            pagination.innerHTML = html;

            // Gán sự kiện click
            document.querySelectorAll('.pagination_item_link').forEach(link => {
                link.onclick = function(e) {
                    e.preventDefault();
                    const page = parseInt(this.getAttribute('data-page'));
                    if (page >= 1 && page <= totalPages && page !== currentPage) {
                        fetchAndRenderProducts(page);
                    }
                }
            });
        }

        // Hàm addToCart nếu chưa có
        window.addToCart = function(product) {
            alert("Đã thêm sản phẩm vào giỏ: " + product.name);
        };

        // Hàm chuyển trang chi tiết sản phẩm
        window.goToProductDetail = function(id) {
            window.location.href = `chitietsanpham.html?id=${id}`;
        };

        // Khởi động lần đầu
        fetchAndRenderProducts(1);
    });
    </script>
</body>
</html>